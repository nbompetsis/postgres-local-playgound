ARG POSTGRES_TAG=${POSTGRES_TAG}
FROM postgres:${POSTGRES_TAG}

RUN touch /opt/init.sql

ARG DATABASE_NAME
ARG DATABASE_USER
ARG DATABASE_USER_PASSWORD

ARG DATABASE_NAME_VALUE=${DATABASE_NAME}
ARG DATABASE_USER_VALUE=${DATABASE_USER}
ARG DATABASE_USER_PASSWORD_VALUE=${DATABASE_USER_PASSWORD}

RUN echo "CREATE DATABASE \"$DATABASE_NAME_VALUE\";" > /opt/init.sql
RUN echo "CREATE USER \"$DATABASE_USER_VALUE\" WITH SUPERUSER ENCRYPTED PASSWORD '$DATABASE_USER_PASSWORD_VALUE';" >> /opt/init.sql
RUN echo "GRANT ALL PRIVILEGES ON DATABASE \"$DATABASE_NAME_VALUE\" TO \"$DATABASE_USER_VALUE\";" >> /opt/init.sql

RUN mv /opt/init.sql /docker-entrypoint-initdb.d/